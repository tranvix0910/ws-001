<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.128.0">
    <meta name="description" content="">
<meta name="author" content="journeyoftheaverageguy@gmail.com">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Build và Push Docker Image :: AWS System Manager</title>

    
    <link href="/css/nucleus.css?1725427517" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1725427517" rel="stylesheet">
    <link href="/css/hybrid.css?1725427517" rel="stylesheet">
    <link href="/css/featherlight.min.css?1725427517" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1725427517" rel="stylesheet">
    <link href="/css/auto-complete.css?1725427517" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1725427517" rel="stylesheet">
    <link href="/css/theme.css?1725427517" rel="stylesheet">
    <link href="/css/hugo-theme.css?1725427517" rel="stylesheet">
    
    <link href="/css/theme-workshop.css?1725427517" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1725427517"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/3-pipeline/3.2-build-and-push-image/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1725427517"></script>
<script type="text/javascript" src="/js/auto-complete.js?1725427517"></script>
<script type="text/javascript">
    
        var baseurl = "\/\/localhost:1313\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1725427517"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/1-introduce/" title="Giới thiệu" class="dd-item 
        
        
        
        ">
      <a href="/1-introduce/">
           <b> 1. </b> Giới thiệu
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/1-introduce/1.1-implementationprocess/" title="Quy trình DevSecOps" class="dd-item 
        
        
        
        ">
      <a href="/1-introduce/1.1-implementationprocess/">
           <b> 1.1 </b> Quy trình DevSecOps
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/1-introduce/1.2-gitlabcicd/" title="Gitlab CI/CD" class="dd-item 
        
        
        
        ">
      <a href="/1-introduce/1.2-gitlabcicd/">
           <b> 1.2 </b> Gitlab CI/CD
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/1-introduce/1.3-tools/" title="DevSecOps Tools" class="dd-item 
        
        
        
        ">
      <a href="/1-introduce/1.3-tools/">
           <b> 1.3 </b> DevSecOps Tools
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/2-preparation/" title="Thiết lập dự án" class="dd-item 
        
        
        
        ">
      <a href="/2-preparation/">
           <b> 2. </b> Thiết lập dự án
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/2-preparation/2.1-setupservers/" title="Thiết lập các Server cho dự án" class="dd-item 
        
        
        
        ">
      <a href="/2-preparation/2.1-setupservers/">
           <b> 2.1 </b> Thiết lập các Server cho dự án
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-preparation/2.2-containerregistry/" title="Private Container Registry - Portus" class="dd-item 
        
        
        
        ">
      <a href="/2-preparation/2.2-containerregistry/">
           <b> 2.2 </b> Private Container Registry - Portus
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-preparation/2.3-gitlabserver/" title="Gitlab Server" class="dd-item 
        
        
        
        ">
      <a href="/2-preparation/2.3-gitlabserver/">
           <b> 2.3 </b> Gitlab Server
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-preparation/2.4-database/" title="Database Server" class="dd-item 
        
        
        
        ">
      <a href="/2-preparation/2.4-database/">
           <b> 2.4 </b> Database Server
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-preparation/2.5-snyk/" title="Source Code Security - Snyk" class="dd-item 
        
        
        
        ">
      <a href="/2-preparation/2.5-snyk/">
           <b> 2.5 </b> Source Code Security - Snyk
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-preparation/2.6-trivy/" title="Trivy Security Scan Image" class="dd-item 
        
        
        
        ">
      <a href="/2-preparation/2.6-trivy/">
           <b> 2.6 </b> Trivy Security Scan Image
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-preparation/2.7-arachni/" title="Web Application Security Scan" class="dd-item 
        
        
        
        ">
      <a href="/2-preparation/2.7-arachni/">
           <b> 2.7 </b> Web Application Security Scan
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-preparation/2.8-k6/" title="Performance Testing - k6" class="dd-item 
        
        
        
        ">
      <a href="/2-preparation/2.8-k6/">
           <b> 2.8 </b> Performance Testing - k6
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/3-pipeline/" title="Thiết lập CI/CD Pipeline" class="dd-item 
        parent
        
        
        ">
      <a href="/3-pipeline/">
           <b> 3. </b> Thiết lập CI/CD Pipeline
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/3-pipeline/3.1-gitlab-runner/" title="Thiết lập Gitlab Runner" class="dd-item 
        
        
        
        ">
      <a href="/3-pipeline/3.1-gitlab-runner/">
           <b> 3.1 </b> Thiết lập Gitlab Runner
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-pipeline/3.2-build-and-push-image/" title="Build và Push Docker Image" class="dd-item 
        
        active
        
        ">
      <a href="/3-pipeline/3.2-build-and-push-image/">
           <b> 3.2 </b> Build và Push Docker Image
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-pipeline/3.3-security-performance/" title="Security Scan và Performance Test" class="dd-item 
        
        
        
        ">
      <a href="/3-pipeline/3.3-security-performance/">
           <b> 3.3 </b> Security Scan và Performance Test
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-pipeline/3.4-send-report/" title="Gửi Report vào Telegram" class="dd-item 
        
        
        
        ">
      <a href="/3-pipeline/3.4-send-report/">
           <b> 3.4 </b> Gửi Report vào Telegram
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/4-deployk8s/" title="Triển khai dự án trên Kubernetes" class="dd-item 
        
        
        
        ">
      <a href="/4-deployk8s/">
           <b> 4. </b> Triển khai dự án trên Kubernetes
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/5-gitops/" title="GitOps" class="dd-item 
        
        
        
        ">
      <a href="/5-gitops/">
           <b> 5. </b> GitOps
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj/"><i class='fab fa-facebook'></i> AWS Study Group</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="//localhost:1313/3-pipeline/3.2-build-and-push-image/" selected>English</option>
                    
                  
              
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    
     <b> Workshop</b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title="Migrate" Alt="web counter"   border="0" /></a>  <br>
     <b> <a href="https://cloudjourney.awsstudygroup.com/">Cloud Journey</a></b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" Alt="web counter"   border="0"   />
     
</left>
<left>
    <br>
    <br>
        <b> Last Updated </b> <br>
        <i><font color=orange>03-09-2024</font></i>
    </left>
    <left>
        <br>
        <br>
            <b> Team </b> <br>
            <i> <a href="https://www.linkedin.com/in/tranvix0910/"  style="color:orange">Đại Vĩ  </a> <br>
               
        </i>
        </left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>DevSecOps Pipeline</a> > <a href='/3-pipeline/'>Thiết lập CI/CD Pipeline</a> > Build và Push Docker Image
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Build và Push Docker Image
            </h1>
          

        



	<h4 id="thiết-lập-các-cấu-hình-cần-thiết">Thiết lập các cấu hình cần thiết.</h4>
<p>Trước khi tạo Dockerfile, bạn cần cập nhật giá trị BASE_URL trong frontend để trỏ đến địa chỉ server backend mà bạn sẽ deploy. Cụ thể, bạn cần thay đổi thông số này trong file cấu hình của frontend.</p>
<p>Để thực hiện điều này trên GitLab, hãy làm theo các bước sau:</p>
<p>Truy cập file cấu hình:</p>
<ul>
<li>
<p>Trong dự án frontend của bạn trên GitLab, điều hướng đến file cấu hình <code>src/config/utils.js</code>.</p>
</li>
<li>
<p>Thay đổi giá trị <code>BASE_URL</code> để trỏ tới server deploy backend hiện tại.</p>
</li>
</ul>
<p><img alt="alt text" src="/images/3-pipeline/3.2-build-and-push-image/3-2-1.png"></p>
<p>Tiếp theo chúng ta sẽ thực hiện tạo một nhánh ( branch ) mới.</p>
<p>Để đảm bảo tính ổn định của nhánh chính (Main), hãy tạo một nhánh mới để thực hiện các thay đổi. Điều này giúp giữ cho nhánh Main không bị ảnh hưởng trong quá trình phát triển.</p>
<p>Truy cập vào dấu <code>+</code> và chọn <code>New Branch</code>.
<img alt="alt text" src="/images/3-pipeline/3.2-build-and-push-image/3-2-2.png"></p>
<p>Chúng ta sẽ đặt tên và tạo Branch.</p>
<p><img alt="alt text" src="/images/3-pipeline/3.2-build-and-push-image/3-2-3.png"></p>
<p>Chúng ta sẽ thực hiện thêm một số cấu hình sau để đảm bảo tính bảo mật.</p>
<p>Truy cập vào <code>Settings</code> -&gt; <code>Repository</code></p>
<p><img alt="alt text" src="/images/3-pipeline/3.2-build-and-push-image/3-2-4.png"></p>
<p>Thay đổi nhánh mặc định thành nhánh vừa tạo, việc này nhầm mục địch khi chúng ta truy cập vào Project, Source code của nhánh Develop sẽ xuất hiện đầu tiên.</p>
<p><img alt="alt text" src="/images/3-pipeline/3.2-build-and-push-image/3-2-5.png"></p>
<p>Tiếp theo chúng ta sẽ thực hiện Protect Branch, khi bảo vệ nhánh có thể giữ an toàn cho nhánh tránh các tình huống Push và Merge.</p>
<p><img alt="alt text" src="/images/3-pipeline/3.2-build-and-push-image/3-2-6.png"></p>
<h4 id="thêm-user-gitlab-runner-vào-group-docker">Thêm User Gitlab-Runner vào Group Docker</h4>
<p>Trong quá trình chạy Pipeline, User gitlab-runner sẽ được dùng để chạy dự án.</p>
<p>Việc thêm gitlab-runner vào Group Docker giúp cho User có thể thực hiện các câu lệnh Docker như : Login, Logout Build và Push Image.</p>
<pre tabindex="0"><code>sudo usermod -aG docker gitlab-runner
</code></pre><ul>
<li>
<p><code>sudo</code>: Chạy lệnh với quyền quản trị.</p>
</li>
<li>
<p><code>usermod</code>: Công cụ để sửa đổi tài khoản người dùng.</p>
</li>
<li>
<p><code>-aG docker</code>: Tùy chọn <code>-aG</code> thêm người dùng vào nhóm chỉ định mà không loại họ khỏi các nhóm khác.</p>
</li>
<li>
<p><code>gitlab-runner</code>: Tên của người dùng cần thêm vào nhóm docker.</p>
</li>
</ul>
<h4 id="tạo-dockerfile">Tạo Dockerfile</h4>
<p>Truy cập vào Web IDE để tiện cho việc thao tác.</p>
<p><img alt="alt text" src="/images/3-pipeline/3.2-build-and-push-image/3-2-7.png">
<img alt="alt text" src="/images/3-pipeline/3.2-build-and-push-image/3-2-8.png"></p>
<p>Tạo Dockerfile cho Frontend:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Dockerfile" data-lang="Dockerfile"><span style="display:flex;"><span><span style="color:#75715e">##### Dockerfile #####</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">## build stage ##</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> node:22-alpine AS build</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> /app</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> . .<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> npm install<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> npm run build<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">## run stage ##</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> nginx:alpine</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> --from<span style="color:#f92672">=</span>build /app/build /usr/share/nginx/html<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">EXPOSE</span><span style="color:#e6db74"> 80</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">CMD</span> [<span style="color:#e6db74">&#34;nginx&#34;</span>, <span style="color:#e6db74">&#34;-g&#34;</span>, <span style="color:#e6db74">&#34;daemon off;&#34;</span>]<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><h4 id="tạo-gitlab-cicd">Tạo Gitlab CI/CD</h4>
<p>Tiến hành tạo file <code>.gitlab-ci.yml</code>.</p>

<div class="notices note" ><p>Tệp <code>.gitlab-ci.yml</code> là một tệp cấu hình được sử dụng trong GitLab CI/CD. Nó định nghĩa các pipeline, các job, và các stage để tự động hóa các tác vụ như xây dựng, kiểm thử và triển khai mã nguồn khi có sự thay đổi trong kho lưu trữ (repository).</p>
</div>

<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#f92672">variables</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">PROJECT_USER</span>: <span style="color:#e6db74">&#34;wineapp&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">IMAGE_VERSION</span>: <span style="color:#e6db74">&#34;${PORTUS_URL}/${PROJECT_USER}/${CI_PROJECT_NAME}:${CI_COMMIT_TAG}_${CI_COMMIT_SHORT_SHA}&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#f92672">stages</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">build</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">push</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">build</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">stage</span>: <span style="color:#ae81ff">build</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">variables</span>: 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">GIT_STRATEGY</span>: <span style="color:#ae81ff">clone</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">before_script</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">docker login -u ${PORTUS_USER} -p ${PORTUS_PASSWORD} ${PORTUS_URL}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">script</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">docker build -t ${IMAGE_VERSION} .</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">after_script</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">docker logout ${PORTUS_URL}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">tags</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">wineapp-build-shell</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">only</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">tags</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">push</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">stage</span>: <span style="color:#ae81ff">push</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">variables</span>: 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">GIT_STRATEGY</span>: <span style="color:#ae81ff">none</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">before_script</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">docker login -u ${PORTUS_USER} -p ${PORTUS_PASSWORD} ${PORTUS_URL}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">script</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">docker push ${IMAGE_VERSION}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">after_script</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">docker logout ${PORTUS_URL}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">tags</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">wineapp-build-shell</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">only</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">tags</span>
</span></span></code></pre></div><p>Tệp cấu hình GitLab CI/CD được viết bằng YAML.</p>
<p>Trước khi giải thích chi tiết về file cấu hình trên, chúng ta sẽ tìm hiểu về <strong>Biến (Variables)</strong> trong Gitlab CI/CD.</p>
<p>Variables có 2 loại chính:</p>
<p><strong>Biến mặc định (Predefined Variables)</strong>:</p>
<ul>
<li>Được GitLab cung cấp tự động trong mỗi pipeline.</li>
<li>Ví dụ:
<ul>
<li><strong>CI_COMMIT_SHA</strong>: SHA của commit hiện tại.</li>
<li><strong>CI_JOB_ID</strong>: ID của công việc (job) hiện tại.</li>
<li><strong>CI_PROJECT_NAME</strong>: Tên của dự án.</li>
<li><strong>CI_COMMIT_REF_NAME</strong>: Tên nhánh (branch) hoặc tag của commit hiện tại.</li>
<li><strong>CI_PIPELINE_ID</strong>: ID của pipeline.</li>
</ul>
</li>
</ul>
<p><strong>Biến do người dùng định nghĩa (User-defined Variables)</strong>:</p>
<ul>
<li>Được người dùng tự định nghĩa trong tệp <code>.gitlab-ci.yml</code> hoặc trong phần cài đặt của dự án trên GitLab.</li>
<li>Định nghĩa trong <code>.gitlab-ci.yml</code>:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">variables</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">PROJECT_USER</span>: <span style="color:#e6db74">&#34;wineapp&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">PORTUS_URL</span>: <span style="color:#e6db74">&#34;https://registry.example.com&#34;</span>
</span></span></code></pre></div><ul>
<li>
<p>Định nghĩa trong cài đặt dự án <code>Project Settings &gt; CI/CD &gt; Variables</code>:</p>
<ul>
<li>
<p>Có thể được thiết lập ở mức dự án, nhóm, hoặc pipeline cụ thể.</p>
</li>
<li>
<p>Hỗ trợ tính năng protected, masked, và scoped (cho phép giới hạn biến chỉ trong một số môi trường hoặc nhánh cụ thể).</p>
</li>
</ul>
</li>
</ul>
<p>Trong dự án, Đầu tiên sẽ khai báo các biến (Variables):</p>
<ul>
<li>
<p><strong>PROJECT_USER</strong>: Được dùng để định nghĩa User để triển khai dự án.</p>
</li>
<li>
<p><strong>IMAGE_VERSION</strong>: Tạo tag cho Docker image sử dụng một số biến:</p>
<ul>
<li>
<p><code>${PORTUS_URL}</code>: URL của Docker registry (có thể là Portus).</p>
</li>
<li>
<p><code>${PROJECT_USER}</code>: Người dùng dưới đó image sẽ được lưu trữ.</p>
</li>
<li>
<p><code>${CI_PROJECT_NAME}</code>: Tên dự án.</p>
</li>
<li>
<p><code>${CI_COMMIT_TAG}</code>: Tag gắn với commit (có thể là số phiên bản).</p>
</li>
<li>
<p><code>${CI_COMMIT_SHORT_SHA}</code>: Phiên bản rút gọn của SHA commit.</p>
</li>
</ul>
</li>
</ul>

<div class="notices note" ><p>Chúng ta có thể lấy giá trị của biến bằng cách <code>${&lt;Variable&gt;}</code></p>
</div>

<p>Tiếp theo chúng ta sẽ tạo các <strong>Stage</strong> cho Pipeline:</p>
<p>Chúng ta sẽ định nghĩa pipeline chúng ta có 2 giai đoạn chính là <strong>build</strong> và <strong>push</strong>.</p>
<ul>
<li>
<p><strong>build</strong>: Giai đoạn mà Docker image được xây dựng.</p>
</li>
<li>
<p><strong>push</strong>: Giai đoạn mà Docker image đã xây dựng được đẩy lên Docker registry.</p>
</li>
</ul>
<p><strong>Stage Build</strong> chúng ta sẽ thực hiện những bước sau:</p>
<ul>
<li>
<p><code>GIT_STRATEGY: clone</code> : Chỉ định rằng kho mã nguồn sẽ được clone (hành vi mặc định).</p>
</li>
<li>
<p><code>before_script</code> : Các lệnh được thực hiện trước khi chạy script chính. Đăng nhập vào Docker registry sử dụng thông tin đăng nhập được lưu trong các biến môi trường <code>${PORTUS_USER}</code> và <code>${PORTUS_PASSWORD}</code>.</p>
</li>
<li>
<p><code>script</code> : Phần chính của giai đoạn này, xây dựng Docker image với tag <code>IMAGE_VERSION</code> đã được chỉ định.</p>
</li>
<li>
<p><code>after_script</code> : Đăng xuất khỏi Docker registry sau khi quá trình build hoàn thành.</p>
</li>
<li>
<p><code>tags</code> : Chỉ định runner (wineapp-build-shell) sẽ được sử dụng cho công việc này.</p>
</li>
<li>
<p><code>only</code> : Đảm bảo công việc này chỉ chạy khi một <strong>Git Tag</strong> được đẩy lên.</p>
</li>
</ul>

<div class="notices note" ><p>Thông thường khi code chúng ta có thay đổi Gitlab CI/CD sẽ tiến hành khởi động Pipeline, Tuy nhiên khi chúng ta khai báo <code>only: -tags</code>, việc chạy Pipeline sẽ được tiến hành khi chúng ta tạo Tag.</p>
</div>

<p><strong>Stage Push</strong> tương tự như Stage Build tuy nhiên chúng ta sẽ khai báo khác một tí:</p>
<ul>
<li>
<p><code>GIT_STRATEGY : none</code> : chúng ta sẽ không cần clone mã nguồn về ở giai đoạn này, vì mã nguồn đã được clone ở Stage trước.</p>
</li>
<li>
<p><code>script</code>: Đẩy Docker image đã được xây dựng lên Docker registry.</p>
</li>
</ul>
<h4 id="tạo-variables">Tạo Variables</h4>
<p>Sau khi tạo file thành công chúng ta sẽ Commit và tạo các Variables.</p>
<p>Truy cập <code>Project Settings &gt; CI/CD &gt; Variables</code>:</p>
<p><img alt="alt text" src="/images/3-pipeline/3.2-build-and-push-image/3-2-9.png"></p>
<p><img alt="alt text" src="/images/3-pipeline/3.2-build-and-push-image/3-2-10.png"></p>
<p>Tiến hành tạo một số biến chúng ta đã định nghĩa tại Pipeline ( trừ một số biến mặc định của Gitlab CI/CD ).</p>
<p><img alt="alt text" src="/images/3-pipeline/3.2-build-and-push-image/3-2-11.png"></p>
<p><strong>Protect variable</strong> : Các biến chỉ chạy trên các Branch và Tag được Protect.</p>
<p><strong>Expand variable reference</strong>: Bất kỳ ký tự $ nào trong giá trị của biến sẽ được xử lý như một tham chiếu đến một biến khác.</p>
<ul>
<li>Ví dụ :
<ul>
<li>
<p><code>PROJECT_NAME</code> có giá trị là <code>myapp</code>.</p>
</li>
<li>
<p><code>PORTUS_URL</code> có giá trị là <code>https://registry.example.com/$PROJECT_NAME</code>.</p>
</li>
</ul>
</li>
</ul>
<p><img alt="alt text" src="/images/3-pipeline/3.2-build-and-push-image/3-2-12.png"></p>
<p><img alt="alt text" src="/images/3-pipeline/3.2-build-and-push-image/3-2-13.png"></p>
<p>Như vậy đã thêm các biến thành công.</p>
<h4 id="khởi-tạo-pipeline">Khởi tạo Pipeline</h4>
<p>Chúng ta sẽ tiến hành tạo Tag:</p>
<p><img alt="alt text" src="/images/3-pipeline/3.2-build-and-push-image/3-2-14.png"></p>
<p><img alt="alt text" src="/images/3-pipeline/3.2-build-and-push-image/3-2-15.png"></p>
<p>Đặt tên Tag và chú ý chọn đúng Branch.</p>
<p><img alt="alt text" src="/images/3-pipeline/3.2-build-and-push-image/3-2-16.png"></p>
<p>Sau khi tạo Tag, Pipeline sẽ được khởi động.</p>
<p><img alt="alt text" src="/images/3-pipeline/3.2-build-and-push-image/3-2-17.png"></p>
<p><img alt="alt text" src="/images/3-pipeline/3.2-build-and-push-image/3-2-18.png"></p>
<p><img alt="alt text" src="/images/3-pipeline/3.2-build-and-push-image/3-2-19.png"></p>
<p><strong>Job Build</strong> Thành công.</p>
<p><img alt="alt text" src="/images/3-pipeline/3.2-build-and-push-image/3-2-20.png"></p>
<p><strong>Job Push</strong> Thành công.</p>
<p><img alt="alt text" src="/images/3-pipeline/3.2-build-and-push-image/3-2-21.png"></p>
<p>Khi truy cập vào Portus, Repository đã được Push thành công.</p>
<p><img alt="alt text" src="/images/3-pipeline/3.2-build-and-push-image/3-2-22.png"></p>
<p><img alt="alt text" src="/images/3-pipeline/3.2-build-and-push-image/3-2-23.png"></p>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/3-pipeline/3.1-gitlab-runner/" title="Thiết lập Gitlab Runner"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/3-pipeline/3.3-security-performance/" title="Security Scan và Performance Test" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1725427517"></script>
    <script src="/js/perfect-scrollbar.min.js?1725427517"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1725427517"></script>
    <script src="/js/jquery.sticky.js?1725427517"></script>
    <script src="/js/featherlight.min.js?1725427517"></script>
    <script src="/js/highlight.pack.js?1725427517"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1725427517"></script>
    <script src="/js/learn.js?1725427517"></script>
    <script src="/js/hugo-learn.js?1725427517"></script>

    <link href="/mermaid/mermaid.css?1725427517" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1725427517"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
